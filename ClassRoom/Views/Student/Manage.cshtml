@model List<string>
@{
    ViewData["Title"] = "Manage Students";
}

<div class="container mt-5">
    <h1>Manage Students</h1>

    <form asp-action="Save" method="post" id="studentForm">
        <div id="students-container">
            @for (int i = 0; i < Model.Count; i++)
            {
                <div class="row mb-2 student-row">
                    <div class="col-10">
                        <input type="text" name="[@i]" value="@Model[i]" class="form-control" />
                    </div>
                    <div class="col-2">
                        <button type="button" class="btn btn-danger remove-student">Remove</button>
                    </div>
                </div>
            }
        </div>

        <div class="mt-3">
            <button type="button" id="add-student" class="btn btn-primary">Add Student</button>
            <button type="submit" class="btn btn-success">Save Changes</button>
            <a asp-controller="Classroom" asp-action="Index" class="btn btn-secondary">Back to Classroom</a>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $("#studentForm").on("submit", function () {
                $("#add-student, .remove-student").prop("disabled", true);
                $("button[type='submit']").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Saving...');
            });

            $("#add-student").click(function () {
                const index = $(".student-row").length;
                $("#students-container").append(`
                    <div class="row mb-2 student-row">
                        <div class="col-10">
                            <input type="text" name="[${index}]" class="form-control" />
                        </div>
                        <div class="col-2">
                            <button type="button" class="btn btn-danger remove-student">Remove</button>
                        </div>
                    </div>
                `);
            });

            $(document).on("click", ".remove-student", function () {
                $(this).closest(".student-row").remove();
                $(".student-row").each(function (index) {
                    $(this).find("input").attr("name", `[${index}]`);
                });
            });
        });
    </script>
}
